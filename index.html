<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.16/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1/dayjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.7.8/handlebars.min.js" integrity="sha512-E1dSFxg+wsfJ4HKjutk/WaCzK7S2wv1POn1RRPGh8ZK+ag9l244Vqxji3r6wgz9YBf6+vhQEYJZpSjqWFPg9gg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <link href='https://fonts.googleapis.com/css?family=Roboto' rel='stylesheet'>

    <title>CV</title>
    <style>
        html {
            font-size: 1em;
            font-family: 'Roboto';
        }
        .text-theme{
            color: #156;
        }
        .bg-theme{
            background-color: #156;
        }
        .border-theme{
            border-color: #156;
        }
        @media print {
            html {
                font-size: 0.8em
            }
            .break {page-break-before: always;}
            .not-print {
                color: initial !important;
                background-color: initial !important;
                box-shadow: initial !important;
                text-decoration: inherit !important;
            }
        }
        

        /* Apply the class to the div when the screen is small or when printing */
        @media screen and (max-width: 768px) {
            .no-flex {
                display: block!important; /* Use block layout instead of flex */
            }
        }

    </style>
</head>
<body class="bg-theme md:p-6 not-print">
    <template id="cv">
        <div class="md:max-w-6xl md:mx-auto bg-white md:p-6 md:rounded-lg md:shadow-md not-print sm:p-10 p-2">
            <div class="flex flex-col items-center ">
                <h1 class="text-3xl font-bold mb-2 text-theme">{{ data.name }}</h1>
                <p class="text-lg">{{ data.address }}</p>
                <ul class="md:flex gap-4 ">
                    <li><b>Email:</b> <a href="email:{{ data.email }}" class="text-theme not-print underline m-2">{{ data.email }}</a></li>
                    <li><b>Telephone:</b> <a href="tel:{{ data.telephone }}" class="text-theme not-print underline  m-2">{{ data.telephone }}</a></li>
                    <li><b>Website:</b> <a href="{{ data.website }}" class="text-theme not-print underline  m-2" target="_blank">{{ data.website }}</a></li>
                </ul>
            </div>
            <div class="mt-4">
                <div class="mb-2">
                    <h2 class="text-xl font-semibold text-theme	border-b-4 border-theme">Personal Profile</h2>
                    <p>{{ data.personalProfile }}</p>
                </div>

                <div class="mb-2">
                    <h2 class="text-xl font-semibold mb-1 text-theme border-b-4 border-theme">Experience</h2>
                    <div>
                        {{#each data.experience}}
                            <div class="mb-2 ">
                                <div class="justify-between text-theme flex no-flex">
                                    <h3 class="font-semibold">{{ this.employer }} - {{ this.position }}</h3>
                                    <p class="text-gray-600">{{ this.startDate }} - {{this.endDate }}</p>
                                </div>
                                <p>{{ this.description }}</p>
                            </div>
                        {{/each}}
                    </div>
                </div>

                <div class="mb-4 break">
                    <h2 class="text-xl font-semibold  mb-1 text-theme text-theme border-b-4 border-theme">Education</h2>
                    {{#each data.education}}
                        <div class="mb-2">
                            <div class="flex justify-between no-flex">
                                <h3 class="sm:flex flex-col">
                                    <span class="font-semibold text-theme">{{ this.institution }}</span>
                                </h3>
                                <p class="text-gray-600">{{ this.startDate }} - {{this.endDate }}</p>
                            </div>
                            <div class="mb-2 ">
                                {{#each this.qualifications}}
                                <div>
                                    <div class="flex flex-row justify-between me-4 gap-4 ">
                                        <p>{{ this.name }}</p>
                                        <p class="flex sm:flex-row flex-col justify-end text-right">
                                            {{#each this.grades}}
                                                {{ this }}
                                            {{/each}}
                                        </p>
                                    </div>
                                    <div class="text-gray-600 text-sm ml-2">
                                        {{#each this.modules}}
                                            <p>{{ this }}</p>
                                        {{/each}}
                                    </div>
                                </div>
                                {{/each}}
                                <p>{{ this.description }}</p>
                            </div>
                            
                        </div>
                    {{/each}}
                </div>

                <div class="mb-4">
                    <h2 class="text-xl font-semibold mb-1 text-theme border-b-4 border-theme">Interests</h2>
                    <p>{{ data.interests }}</p>
                </div>
            </div>
        </div>
    </template>
    <div id="render">

    </div>
    <script>
        
        //https://gist.github.com/steveosoule/59bacaee9c4209353e3b8b6ea37fa460
        function t(s,d){
            for(var p in d)
                s=s.replace(new RegExp('{{'+p+'}}','g'), d[p]);
            return s;
        }
        function loadTemplate(id){
            const dom = document.getElementById(id);
            const clon = dom.content.cloneNode(true);
            return Handlebars.compile(clon.children[0].outerHTML);
        }
        async function fetchCv(url) {
            const response = await fetch(url);
            const cv = await response.json();
            return cv
        }
        function formatDate(timestamp) {
            return dayjs.unix(timestamp).format('MMMM YYYY');
        }
        async function renderCv(parentId,templateId,url){
            const template = loadTemplate(templateId);
            const cv = await fetchCv(url);

            cv.experience.forEach((exp) => {
                exp.startDate = formatDate(exp.startDate);
                exp.endDate = formatDate(exp.endDate);
            });

            cv.education.forEach((edu) => {
                edu.startDate = formatDate(edu.startDate);
                edu.endDate = formatDate(edu.endDate);
            });

            const parentDom = document.getElementById(parentId);
            parentDom.innerHTML = template({data:cv})
            document.title = 'CV - ' + cv.name
        }
        
        renderCv('render','cv','/cv.json')

          
          
          
    </script>
</body>
</html>
